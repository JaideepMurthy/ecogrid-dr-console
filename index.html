<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EcoGrid DR Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    .hidden { display: none !important; }
  </style>
</head>
<body class="app-body">
  <header class="app-header">
    <div class="app-title">EcoGrid DR Console</div>
    <nav class="app-nav">
      <button id="btn-grid" class="nav-btn active" data-view="grid">Grid Overview</button>
      <button id="btn-forecast" class="nav-btn" data-view="forecast">Peak Forecast</button>
      <button id="btn-dr" class="nav-btn" data-view="dr">DR Console</button>
      <button id="btn-history" class="nav-btn" data-view="history">Event History</button>
          <button id="btn-scenario" class="nav-btn" data-view="scenario">Scenario Comparison</button>
    </nav>
  </header>

  <main class="app-main">
    <section class="view-section" id="view-grid">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h1>Grid Overview</h1>
        <div id="dataSourceLabel" style="background: #f39c12; padding: 6px 12px; border-radius: 4px; font-size: 0.85em; color: #fff; font-weight: bold;">üü° Demo: Synthetic Data</div>
      </div>
id="grid-kpis"        " class="kpi-row"></div>
      <div class="chart-container"><canvas id="chart-demand-supply"></canvas></div>
      <div class="chart-container"><canvas id="chart-price"></canvas></div>
      <div class="chart-container"><canvas id="chart-production-mix"></canvas></div>
      <button id="btn-refresh-grid" class="primary-btn">Refresh data</button>
      <p class="hint-text">Uses public Portugal electricity data, cached locally for fast demos.</p>
    </section>

    <section class="view-section hidden" id="view-forecast">
      <h1>Peak Risk Forecast</h1>
      <div id="forecast-timeline" class="forecast-timeline"></div>
      <p id="forecast-summary" class="hint-text"></p>
      <button id="btn-plan-dr" class="primary-btn">Plan DR Event for peak window</button>
      <button id="btn-drill-down" class="secondary-btn" style="margin-left: 8px; padding: 8px 16px; background: #4ECDC4; color: white; border: none; border-radius: 4px; cursor: pointer;">üîç Factor Breakdown</button>
    </section>

    <section class="view-section hidden" id="view-dr">
      <h1>DR Event Console</h1>
      <form id="dr-form" class="dr-form">
        <label style="margin-bottom: 15px;">Operator Name <input type="text" id="operator-name" placeholder="Your name (for audit trail)" style="width:100%; padding:8px;" /></label>
        <label>Target reduction (MW) <input type="number" id="dr-target-mw" required min="10" step="10" /></label>
        <label>Start time (local) <input type="datetime-local" id="dr-start-time" required /></label>
        <label>Duration (hours) <input type="number" id="dr-duration-hours" required min="0.5" step="0.5" /></label>
        <label style="margin-top: 15px;">Ramping Profile (min to reach full reduction): <input type="range" id="dr-ramp-min" min="5" max="30" value="10" step="5" /><span id="ramp-display">10 min</span></label>
        <fieldset>
          <legend>Segments (share of flexible load)</legend>
          <label>Industrial & Commercial HVAC (%) <input type="number" id="seg-industrial" value="40" min="0" max="100" /></label>
          <label>EV charging fleets (%) <input type="number" id="seg-ev" value="35" min="0" max="100" /></label>
          <label>Commercial refrigeration (%) <input type="number" id="seg-commercial" value="25" min="0" max="100" /></label>
        </fieldset>
        <button type="submit" class="primary-btn">Simulate DR Event</button>
      </form>
      <section id="dr-result" class="dr-result"></section>
    </section>

    <section class="view-section hidden" id="view-history">
      <h1>Event History & ROI</h1>
      <button id="btn-export-audit" class="primary-btn" style="margin-bottom: 16px;">üìã Export Compliance Report (CSV)</button>
      <div id="history-aggregates" class="kpi-row"></div>
      <div class="chart-container"><canvas id="chart-history-mw"></canvas></div>
      <div class="chart-container"><canvas id="chart-history-cost"></canvas></div>
      <table id="history-table" class="history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Target MW</th>
            <th>Achieved MW</th>
            <th>Duration (h)</th>
            <th>EUR Saved</th>
            <th>CO2 Avoided (t)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
    
  <section class="view-section hidden" id="view-scenario">
    <h1>Scenario Comparison</h1>
    <p class="hint-text">Compare DR event outcomes against baseline "do nothing" scenario</p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
      <div>
        <h3>Baseline (No DR)</h3>
        <div id="scenario-baseline-metrics"></div>
        <canvas id="chart-scenario-baseline" class="chart-container"></canvas>
      </div>
      <div>
        <h3>With DR Event</h3>
        <div id="scenario-with-metrics"></div>
        <canvas id="chart-scenario-with" class="chart-container"></canvas>
      </div>
    </div>
    
    <div style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 20px;">
      <h3>Impact Summary</h3>
      <table style="width: 100%; margin-top: 10px;">
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 10px;"><strong>Metric</strong></td>
          <td style="padding: 10px;"><strong>Baseline</strong></td>
          <td style="padding: 10px;"><strong>With DR</strong></td>
          <td style="padding: 10px;"><strong>Savings</strong></td>
        </tr>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 10px;">Peak Demand (MW)</td>
          <td style="padding: 10px;" id="scenario-baseline-peak">-</td>
          <td style="padding: 10px;" id="scenario-with-peak">-</td>
          <td style="padding: 10px; color: green;" id="scenario-peak-savings">-</td>
        </tr>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 10px;">Cost (EUR)</td>
          <td style="padding: 10px;" id="scenario-baseline-cost">-</td>
          <td style="padding: 10px;" id="scenario-with-cost">-</td>
          <td style="padding: 10px; color: green;" id="scenario-cost-savings">-</td>
        </tr>
        <tr>
          <td style="padding: 10px;">CO2 Avoided (t)</td>
          <td style="padding: 10px;" id="scenario-baseline-co2">0</td>
          <td style="padding: 10px;" id="scenario-with-co2">-</td>
          <td style="padding: 10px; color: green;" id="scenario-co2-savings">-</td>
        </tr>
      </table>
    </div>
  </section>
  </main>

  <footer class="app-footer"><span>EcoGrid DR Console - TecStorm Demo</span></footer>

  <script type="module">
    import { initApp } from './js/app.js';
    
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ DOM Content Loaded - initializing EcoGrid...');
      initApp();
    });
  </script>
</body>
</html>
